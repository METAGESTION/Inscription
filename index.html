<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Studio</title>
    
    <!-- FAVICON (Votre lien) -->
    <link rel="icon" href="https://fv5-5.files.fm/thumb_show.php?i=bg4k8pheyj&view&v=1&PHPSESSID=6a5abacfc85fc24782be0d442de527f6ff5fe8ab">

    <!-- Police et Icônes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg: #f0f2f5;
            --surface: #ffffff;
            --text: #0f172a;
            --text-sec: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --error: #ef4444;
            --radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }

        .hidden { display: none !important; }
        
        /* --- Header --- */
        header {
            background: var(--surface); padding: 1rem 2rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            flex-wrap: wrap;
        }
        .logo { 
            font-weight: 800; color: var(--primary); font-size: 1.4rem; 
            display: flex; align-items: center; gap: 12px; letter-spacing: -0.5px; 
        }
        .logo-img {
            height: 32px; width: auto; object-fit: contain;
        }
        
        .nav-actions { display: flex; align-items: center; gap: 15px; }
        
        .btn-studio {
            background-color: var(--primary); color: white; border: none;
            padding: 8px 20px; border-radius: var(--radius); font-weight: 600;
            cursor: pointer; display: flex; align-items: center; gap: 8px;
            transition: background 0.2s; text-decoration: none; white-space: nowrap;
        }
        .btn-studio:hover { background-color: var(--primary-hover); }

        .user-display { font-weight: 500; color: var(--text); font-size: 0.9rem; }

        /* --- Main Layout --- */
        main { flex: 1; display: flex; justify-content: center; align-items: flex-start; padding: 2rem; gap: 2rem; flex-direction: column; }

        .card {
            background: var(--surface); width: 100%; max-width: 800px;
            padding: 2.5rem; border-radius: var(--radius); box-shadow: var(--shadow);
            text-align: center; margin: 0 auto;
        }

        h2 { text-align: center; margin-bottom: 0.5rem; color: var(--text); }
        p.subtitle { text-align: center; color: var(--text-sec); margin-bottom: 2rem; font-size: 0.95rem; }

        /* --- Forms --- */
        .form-group { margin-bottom: 1.25rem; position: relative; text-align: left; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
        
        input[type="text"], input[type="email"], input[type="number"] {
            width: 100%; padding: 0.8rem; border: 1px solid var(--border);
            border-radius: 8px; font-size: 1rem; transition: border 0.2s;
        }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        .field-error { color: var(--error); font-size: 0.8rem; margin-top: 4px; display: none; }

        .btn {
            width: 100%; padding: 0.9rem; background-color: var(--primary); color: white;
            border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            transition: background 0.2s; font-size: 1rem; margin-top: 10px;
        }
        .btn:hover { background-color: var(--primary-hover); }

        /* --- Section Compte à rebours --- */
        .countdown-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }
        .countdown-text {
            font-size: 1.1rem; font-weight: 500; margin-bottom: 1rem; opacity: 0.9;
        }
        .timer-display {
            font-size: 2.5rem; font-weight: 700; font-family: monospace; letter-spacing: 2px; margin-bottom: 1.5rem;
        }
        .btn-reveal {
            background-color: var(--success); color: white; padding: 1rem 2rem;
            text-decoration: none; border-radius: var(--radius); font-weight: bold;
            font-size: 1.2rem; display: inline-flex; align-items: center; gap: 10px;
            transition: transform 0.2s;
        }
        .btn-reveal:hover { transform: scale(1.05); background-color: #059669; }

        /* --- Section Aperçu --- */
        .preview-section {
            margin-top: 2rem;
            width: 100%; max-width: 800px; margin-left: auto; margin-right: auto;
        }
        .preview-section h3 {
            margin-bottom: 1rem; color: var(--text); font-size: 1.2rem; border-left: 4px solid var(--primary);
            padding-left: 10px;
        }
        .preview-container {
            width: 100%;
            background: white; border-radius: var(--radius); overflow: hidden;
            box-shadow: var(--shadow); display: flex; justify-content: center;
        }
        .preview-container img {
            width: 100%; height: auto; max-height: 400px; object-fit: contain; display: block;
        }

        /* --- Toasts --- */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 350px; }
        .toast {
            background: var(--surface); padding: 1rem 1.5rem; border-radius: var(--radius);
            box-shadow: var(--shadow); border-left: 4px solid var(--primary);
            display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s;
            font-size: 0.9rem;
        }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* --- RESPONSIVE MOBILE --- */
        @media (max-width: 600px) {
            header { padding: 0.8rem 1rem; flex-direction: column; gap: 10px; }
            .nav-actions { width: 100%; justify-content: space-between; gap: 8px; }
            .logo { font-size: 1.2rem; width: 100%; justify-content: center; margin-bottom: 5px; }
            .btn-studio { padding: 6px 12px; font-size: 0.85rem; }
            .user-display { display: none; }
            main { padding: 1rem; }
            .card { padding: 1.5rem; }
            .timer-display { font-size: 1.8rem; letter-spacing: 1px; }
            .countdown-text { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <!-- HEADER -->
    <header id="app-header" class="hidden">
        <div class="logo">
            <img src="https://fv5-5.files.fm/thumb_show.php?i=bg4k8pheyj&view&v=1&PHPSESSID=6a5abacfc85fc24782be0d442de527f6ff5fe8ab" alt="Logo" class="logo-img">
            Meta Studio
        </div>
        <div class="nav-actions">
            <button class="btn-studio" onclick="openMetaStudio()">
                <i class="fa-solid fa-video"></i> Meta Studio
            </button>
            <div class="user-display">
                <i class="fa-regular fa-user"></i> <span id="header-username" style="color: var(--primary);">Utilisateur</span>
            </div>
        </div>
    </header>

    <main>
        <!-- VUE 1 : INSCRIPTION -->
        <section id="register-view" class="card hidden">
            <h2>Créer un compte</h2>
            <p class="subtitle">Rejoignez Meta Studio.</p>
            
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="reg-username" placeholder="Votre pseudo" required>
                </div>

                <div class="form-group">
                    <label>Votre Adresse Email</label>
                    <input type="email" id="reg-email" placeholder="vous@exemple.com" required>
                </div>
                
                <div class="form-group">
                    <label>Code PIN (4 chiffres)</label>
                    <input type="number" id="reg-pin" placeholder="0000" maxlength="4" required>
                </div>

                <button type="submit" class="btn" id="reg-btn">
                    <span>S'inscrire</span>
                </button>
            </form>
        </section>

        <!-- VUE 2 : DASHBOARD -->
        <section id="dashboard-view" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
            
            <div class="card">
                <h2>Tableau de bord</h2>
                <p class="subtitle">Bienvenue sur votre espace créateur.</p>

                <div class="studio-placeholder">
                    <i class="fa-solid fa-clapperboard" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                    <h3>Prêt à publier ?</h3>
                    <p style="color: var(--text-sec); margin: 1rem 0;">
                        Cliquez sur le bouton <strong>"Meta Studio"</strong> en haut pour ouvrir l'éditeur.
                    </p>
                </div>

                <!-- COMPTE A REBOURS -->
                <div class="countdown-container">
                    <p class="countdown-text">Media Social Media sera accessible le Jeudi 26 février à 15 heure</p>
                    <div id="timer" class="timer-display">Chargement...</div>
                    
                    <a id="secret-link" href="https://metagestion.github.io/MetaService/" target="_blank" class="btn-reveal hidden">
                        <i class="fa-solid fa-rocket"></i> Media Social Media
                    </a>
                </div>
            </div>

            <!-- SECTION APERCU -->
            <div class="preview-section">
                <h3>Aperçu</h3>
                <div class="preview-container">
                    <img src="https://fv5-6.files.fm/thumb_show.php?i=t6wcr8ycj2&view&v=1&PHPSESSID=6a5abacfc85fc24782be0d442de527f6ff5fe8ab" alt="Aperçu">
                </div>
            </div>
        </section>
    </main>

    <script>
        /* --- GESTION DE L'ÉTAT --- */
        const state = {
            username: localStorage.getItem('userUsername') || null,
            email: localStorage.getItem('userEmail') || null
        };

        // Vérification connexion immédiate
        if (state.email && state.username) {
            showDashboard();
        } else {
            showRegister();
        }

        function showRegister() {
            document.getElementById('register-view').classList.remove('hidden');
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('app-header').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('register-view').classList.add('hidden');
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('app-header').classList.remove('hidden');
            document.getElementById('header-username').textContent = state.username;
            startCountdown();
        }

        /* --- LOGIQUE COMPTE A REBOURS --- */
        function startCountdown() {
            const countDownDate = new Date("2026-02-26T15:00:00Z").getTime();
            const timerInterval = setInterval(function() {
                const now = new Date().getTime();
                const distance = countDownDate - now;

                if (distance < 0) {
                    clearInterval(timerInterval);
                    document.getElementById("timer").innerHTML = "DISPONIBLE !";
                    document.getElementById("secret-link").classList.remove("hidden");
                } else {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    document.getElementById("timer").innerHTML = 
                        days + "j " + hours + "h " + minutes + "m " + seconds + "s ";
                }
            }, 1000);
        }

        /* --- LOGIQUE META STUDIO --- */
        function openMetaStudio() {
            showToast("Ouverture de Meta Studio...", "success");
            const baseUrl = "https://form.jotform.com/260536291884061";
            const params = new URLSearchParams({
                user: state.username,
                email: state.email
            });
            window.open(`${baseUrl}?${params.toString()}`, '_blank');
        }

        /* --- LOGIQUE D'INSCRIPTION (MODIFIÉE : PAS D'ENVOI DU PIN) --- */
        async function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('reg-username').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const pin = document.getElementById('reg-pin').value.trim();
            const btn = document.getElementById('reg-btn');

            if (!username || !email || !pin) {
                showToast("Veuillez remplir tous les champs.", "error");
                return;
            }

            // Vérification que le PIN fait bien 4 chiffres
            if (!/^\d{4}$/.test(pin)) {
                showToast("Le code PIN doit contenir exactement 4 chiffres.", "error");
                return;
            }

            // Sauvegarde locale (Le PIN est gardé ici, mais PAS envoyé)
            localStorage.setItem('userUsername', username);
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userPin', pin);
            
            state.username = username;
            state.email = email;

            // Envoi à Formspree (NOUVEAU LIEN + PAS DE PIN)
            const formData = new FormData();
            formData.append('email', email);
            formData.append('username', username);
            
            // On n'envoie PAS le PIN pour éviter le bannissement
            formData.append('message', `Nouvelle inscription de l'utilisateur : ${username}`);
            formData.append('_subject', `Nouvelle Inscription : ${username}`);

            // NOUVEAU LIEN INTÉGRÉ ICI
            fetch('https://formspree.io/f/xkovkjjp', {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) console.log("Inscription envoyée à l'admin");
            }).catch(error => {
                console.error("Erreur Formspree", error);
            });

            btn.innerHTML = '<span>Inscription en cours...</span>';
            showToast("Inscription validée !", "success");

            setTimeout(() => {
                location.reload(); 
            }, 1500);
        }

        function showToast(msg, type = 'default') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = type === 'success' ? '<i class="fa-solid fa-check"></i>' : 
                       type === 'error' ? '<i class="fa-solid fa-triangle-exclamation"></i>' : 
                       '<i class="fa-solid fa-info-circle"></i>';
                       
            toast.innerHTML = `${icon} <span>${msg}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>
